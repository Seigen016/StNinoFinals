{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseClient.ts"],"sourcesContent":["// lib/supabaseClient.ts\nimport { createClient } from '@supabase/supabase-js'\n\n// Get environment variables\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n\n// Validate that environment variables are set\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables')\n}\n\n// Create Supabase client\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\n\n// Optional: Create a client with service role for admin operations\n// DO NOT expose this in client-side code\nexport const supabaseAdmin = createClient(\n  supabaseUrl,\n  process.env.SUPABASE_SERVICE_ROLE_KEY || '',\n  {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false\n    }\n  }\n)"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;AACxB;;AAEA,4BAA4B;AAC5B,MAAM;AACN,MAAM;AAEN,8CAA8C;AAC9C;;AAKO,MAAM,WAAW,IAAA,mRAAY,EAAC,aAAa;AAI3C,MAAM,gBAAgB,IAAA,mRAAY,EACvC,aACA,QAAQ,GAAG,CAAC,yBAAyB,IAAI,IACzC;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/student/login/route.ts"],"sourcesContent":["import { supabase } from '@/lib/supabaseClient'\nimport { NextResponse } from 'next/server'\n\nconst buildMockStudent = (email: string) => ({\n  id: 0,\n  email,\n  name: 'Development Student',\n  grade_level: 'Grade 10',\n  section: 'A',\n})\n\nexport async function POST(request: Request) {\n  try {\n    const { email, password } = await request.json()\n    const emailLower = email.toLowerCase().trim()\n\n    if (!email || !password) {\n      return NextResponse.json(\n        { success: false, error: 'Email and password are required' },\n        { status: 400 }\n      )\n    }\n\n    const supabaseClient = supabase\n\n    // Check if Supabase is configured\n    if (!supabaseClient) {\n      console.error('Supabase client not initialized')\n      if (process.env.NODE_ENV === 'development') {\n        return NextResponse.json({\n          success: true,\n          student: buildMockStudent(emailLower),\n          mock: true,\n          warning: 'Supabase not configured. Returning mock student in development.',\n        })\n      }\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Database service not configured. Please check your environment variables.' \n        },\n        { status: 500 }\n      )\n    }\n\n    // Query the students table for a matching email (case-insensitive)\n    \n    const { data: students, error } = await supabaseClient\n      .from('students')\n      .select('*')\n      .limit(10) // Get multiple to check case sensitivity\n\n    if (error) {\n      console.error('Database error:', error)\n      \n      // Provide more specific error messages\n      const errorMsg = error.message || String(error) || ''\n      if (error.code === '42P01' || (errorMsg && errorMsg.includes('does not exist'))) {\n        return NextResponse.json({\n          success: false,\n          error: 'Students table does not exist in the database. Please create the students table first.',\n        }, { status: 500 })\n      }\n      \n      if (error.code === 'PGRST116' || (errorMsg && errorMsg.includes('relation'))) {\n        return NextResponse.json({\n          success: false,\n          error: 'Database connection error. Please check your Supabase configuration.',\n        }, { status: 500 })\n      }\n\n      // In development, provide more detailed error\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('Database error (development mode):', errorMsg, error.code)\n        return NextResponse.json({\n          success: false,\n          error: `Database error: ${errorMsg}. Please check if the students table exists and has 'email' and 'Password' columns.`,\n        }, { status: 500 })\n      }\n      \n      return NextResponse.json(\n        { success: false, error: 'Database connection error. Please try again later.' },\n        { status: 500 }\n      )\n    }\n\n    // Debug: Log all students and their emails (in development only)\n    if (process.env.NODE_ENV === 'development' && students) {\n      console.log('Found students:', students.length)\n      console.log('Looking for email:', emailLower)\n      students.forEach((s: any, idx: number) => {\n        console.log(`Student ${idx}:`, {\n          email: s.email,\n          emailLower: s.email?.toLowerCase(),\n          hasPassword: s.Password !== undefined || s.password !== undefined,\n          passwordField: s.Password !== undefined ? 'Password' : s.password !== undefined ? 'password' : 'none',\n          allKeys: Object.keys(s)\n        })\n      })\n    }\n\n    // Find student by email (case-insensitive)\n    const student = students?.find((s: any) => \n      s.email && s.email.toLowerCase().trim() === emailLower\n    )\n\n    // Check if student exists\n    if (!student) {\n      console.error('Student not found for email:', email)\n      if (process.env.NODE_ENV === 'development') {\n        return NextResponse.json({\n          success: true,\n          student: buildMockStudent(emailLower),\n          mock: true,\n          warning: `Mock student returned because ${email} was not found.`,\n        })\n      }\n      return NextResponse.json(\n        { success: false, error: `No student found with email: ${email}. Please check your email address.` },\n        { status: 401 }\n      )\n    }\n\n    // Check if Password field exists (case-sensitive column name)\n    // Try both 'password' and 'Password' to handle different naming conventions\n    const passwordField = student.Password !== undefined ? 'Password' : \n                          student.password !== undefined ? 'password' : null\n    \n    if (!passwordField) {\n      console.error('Password field not found in student record. Available fields:', Object.keys(student))\n      return NextResponse.json(\n        { success: false, error: 'Database configuration error: Password field not found in student record.' },\n        { status: 500 }\n      )\n    }\n\n    // Compare passwords\n    // Note: In production, passwords should be hashed using bcrypt or similar\n    // For now, this assumes plain text comparison. You should hash passwords when storing them.\n    const studentPassword = passwordField === 'Password' ? student.Password : student.password\n    \n    // Debug logging (development only)\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Password comparison:', {\n        provided: password,\n        stored: studentPassword ? '***' : 'null/undefined',\n        match: studentPassword === password,\n        fieldName: passwordField\n      })\n    }\n    \n    if (!studentPassword || studentPassword !== password) {\n      console.error('Password mismatch for email:', email)\n      return NextResponse.json(\n        { success: false, error: 'Invalid password. Please check your password and try again.' },\n        { status: 401 }\n      )\n    }\n\n    // Remove password from response for security\n    const studentWithoutPassword = { ...student }\n    if (studentWithoutPassword.Password !== undefined) {\n      delete studentWithoutPassword.Password\n    }\n    if (studentWithoutPassword.password !== undefined) {\n      delete studentWithoutPassword.password\n    }\n\n    // Check if this is first login\n    const firstLogin = student.first_login === true || student.first_login === 1 || student.firstLogin === true\n\n    return NextResponse.json({\n      success: true,\n      student: studentWithoutPassword,\n      firstLogin: firstLogin,\n    })\n  } catch (error: any) {\n    console.error('Student login API error:', error)\n    \n    // Handle network errors\n    if (error.message?.includes('fetch') || error.message?.includes('network')) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('Supabase fetch failed in development. Returning mock student.')\n        return NextResponse.json({\n          success: true,\n          student: buildMockStudent('dev@example.com'),\n          mock: true,\n          warning: 'Supabase fetch failed. Mock student returned.',\n        })\n      }\n      return NextResponse.json(\n        { success: false, error: 'Network error. Please check your internet connection.' },\n        { status: 500 }\n      )\n    }\n    \n    return NextResponse.json(\n      { success: false, error: error?.message || 'Internal server error. Please try again.' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}