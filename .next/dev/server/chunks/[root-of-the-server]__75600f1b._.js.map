{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Supabase Admin Client for Server-Side Operations\n * \n * ⚠️ SECURITY WARNING: This client uses the SERVICE ROLE KEY\n * - Bypasses ALL Row Level Security (RLS) policies\n * - Full database access with no restrictions\n * - ONLY use in server-side code (API routes, Server Components)\n * - NEVER import or use in client-side components\n * \n * Use Cases:\n * - Admin operations requiring elevated privileges\n * - System-level database operations\n * - Background jobs and cron tasks\n */\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n/**\n * Creates and returns a Supabase admin client instance\n * \n * @returns SupabaseClient with full admin privileges\n * @throws Error if environment variables are not set\n * \n * @example\n * ```ts\n * // In API route or Server Component only\n * const supabaseAdmin = getSupabaseAdmin();\n * const { data } = await supabaseAdmin.from('users').select('*');\n * ```\n */\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA;;;;;;;;;;;;;CAaC,GAED,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAerD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mRAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/admin/parents/link-student/route.ts"],"sourcesContent":["import { getSupabaseAdmin } from '@/lib/supabaseAdmin';\nimport { NextResponse } from 'next/server';\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const {\n      parent_id,\n      student_id,\n      relationship_type,\n      is_primary,\n    } = body\n\n    if (!parent_id || !student_id) {\n      return NextResponse.json(\n        { success: false, error: 'Parent ID and Student ID are required' },\n        { status: 400 }\n      )\n    }\n\n    const supabaseAdmin = getSupabaseAdmin()\n\n    // Check if relationship already exists\n    const { data: existing } = await supabaseAdmin\n      .from('user_relationships')\n      .select('id')\n      .eq('user_id', parent_id)\n      .eq('related_user_id', student_id)\n      .single()\n\n    if (existing) {\n      return NextResponse.json(\n        { success: false, error: 'This student is already linked to this parent' },\n        { status: 400 }\n      )\n    }\n\n    // Create relationship\n    const { error: insertError } = await supabaseAdmin\n      .from('user_relationships')\n      .insert({\n        user_id: parent_id,\n        related_user_id: student_id,\n        relationship_type: relationship_type || 'parent',\n        is_primary: is_primary || false,\n        can_pickup: true,\n      })\n\n    if (insertError) {\n      return NextResponse.json(\n        { success: false, error: insertError.message },\n        { status: 400 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Student linked successfully',\n    })\n  } catch (error: any) {\n    return NextResponse.json(\n      { success: false, error: error?.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,SAAS,EACT,UAAU,EACV,iBAAiB,EACjB,UAAU,EACX,GAAG;QAEJ,IAAI,CAAC,aAAa,CAAC,YAAY;YAC7B,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwC,GACjE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,gBAAgB,IAAA,0IAAgB;QAEtC,uCAAuC;QACvC,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,cAC9B,IAAI,CAAC,sBACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,WACd,EAAE,CAAC,mBAAmB,YACtB,MAAM;QAET,IAAI,UAAU;YACZ,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAgD,GACzE;gBAAE,QAAQ;YAAI;QAElB;QAEA,sBAAsB;QACtB,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,cAClC,IAAI,CAAC,sBACL,MAAM,CAAC;YACN,SAAS;YACT,iBAAiB;YACjB,mBAAmB,qBAAqB;YACxC,YAAY,cAAc;YAC1B,YAAY;QACd;QAEF,IAAI,aAAa;YACf,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO,YAAY,OAAO;YAAC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,OAAO,WAAW;QAAwB,GACnE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}