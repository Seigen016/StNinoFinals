{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAErD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mRAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/admin/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { getSupabaseAdmin } from '@/lib/supabaseAdmin'\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const { email, password } = body\n\n    // Validate input\n    if (!email || !password) {\n      return NextResponse.json(\n        { ok: false, error: 'Email and password are required' },\n        { status: 400 }\n      )\n    }\n\n    const admin = getSupabaseAdmin()\n\n    // Query the Admin table (note: case-sensitive table name)\n    const emailLower = email.toLowerCase().trim()\n    const { data: admins, error } = await admin\n      .from('Admin')\n      .select('*')\n      .limit(10)\n\n    if (error) {\n      console.error('Database error:', error)\n      // Return 200 with error message instead of 500\n      return NextResponse.json(\n        { ok: false, error: 'Database connection error. Please try again.' },\n        { status: 200 } // Return 200 to prevent Internal Server Error page\n      )\n    }\n\n    // Find admin by email (case-insensitive)\n    const adminUser = admins?.find((a: any) => \n      (a.Email || a.email) && (a.Email || a.email).toString().toLowerCase().trim() === emailLower\n    )\n\n    if (!adminUser) {\n      return NextResponse.json(\n        { ok: false, error: 'Invalid email or password' },\n        { status: 401 }\n      )\n    }\n\n    // Check for Password field (both lowercase and capitalized)\n    const adminPassword = adminUser.Password !== undefined ? adminUser.Password : \n                         adminUser.password !== undefined ? adminUser.password : null\n\n    if (!adminPassword || adminPassword !== password) {\n      return NextResponse.json(\n        { ok: false, error: 'Invalid email or password' },\n        { status: 401 }\n      )\n    }\n\n    // Return admin data (excluding password)\n    const adminWithoutPassword = { ...adminUser }\n    if (adminWithoutPassword.Password !== undefined) delete adminWithoutPassword.Password\n    if (adminWithoutPassword.password !== undefined) delete adminWithoutPassword.password\n\n    return NextResponse.json({\n      ok: true,\n      user: adminWithoutPassword,\n      userType: 'admin',\n    })\n  } catch (e: any) {\n    // Return 200 with error message instead of 500 to prevent Internal Server Error\n    return NextResponse.json(\n      { ok: false, error: e?.message ?? 'Unknown error' },\n      { status: 200 } // Always return 200, never 500\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,iBAAiB;QACjB,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAAkC,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,IAAA,0IAAgB;QAE9B,0DAA0D;QAC1D,MAAM,aAAa,MAAM,WAAW,GAAG,IAAI;QAC3C,MAAM,EAAE,MAAM,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,MACnC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,KAAK,CAAC;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,mBAAmB;YACjC,+CAA+C;YAC/C,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAA+C,GACnE;gBAAE,QAAQ;YAAI,EAAE,mDAAmD;;QAEvE;QAEA,yCAAyC;QACzC,MAAM,YAAY,QAAQ,KAAK,CAAC,IAC9B,CAAC,EAAE,KAAK,IAAI,EAAE,KAAK,KAAK,CAAC,EAAE,KAAK,IAAI,EAAE,KAAK,EAAE,QAAQ,GAAG,WAAW,GAAG,IAAI,OAAO;QAGnF,IAAI,CAAC,WAAW;YACd,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAA4B,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,4DAA4D;QAC5D,MAAM,gBAAgB,UAAU,QAAQ,KAAK,YAAY,UAAU,QAAQ,GACtD,UAAU,QAAQ,KAAK,YAAY,UAAU,QAAQ,GAAG;QAE7E,IAAI,CAAC,iBAAiB,kBAAkB,UAAU;YAChD,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,IAAI;gBAAO,OAAO;YAA4B,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,yCAAyC;QACzC,MAAM,uBAAuB;YAAE,GAAG,SAAS;QAAC;QAC5C,IAAI,qBAAqB,QAAQ,KAAK,WAAW,OAAO,qBAAqB,QAAQ;QACrF,IAAI,qBAAqB,QAAQ,KAAK,WAAW,OAAO,qBAAqB,QAAQ;QAErF,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,MAAM;YACN,UAAU;QACZ;IACF,EAAE,OAAO,GAAQ;QACf,gFAAgF;QAChF,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAgB,GAClD;YAAE,QAAQ;QAAI,EAAE,+BAA+B;;IAEnD;AACF"}}]
}