{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Supabase Admin Client for Server-Side Operations\n * \n * ⚠️ SECURITY WARNING: This client uses the SERVICE ROLE KEY\n * - Bypasses ALL Row Level Security (RLS) policies\n * - Full database access with no restrictions\n * - ONLY use in server-side code (API routes, Server Components)\n * - NEVER import or use in client-side components\n * \n * Use Cases:\n * - Admin operations requiring elevated privileges\n * - System-level database operations\n * - Background jobs and cron tasks\n */\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n/**\n * Creates and returns a Supabase admin client instance\n * \n * @returns SupabaseClient with full admin privileges\n * @throws Error if environment variables are not set\n * \n * @example\n * ```ts\n * // In API route or Server Component only\n * const supabaseAdmin = getSupabaseAdmin();\n * const { data } = await supabaseAdmin.from('users').select('*');\n * ```\n */\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA;;;;;;;;;;;;;CAaC,GAED,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAerD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mRAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/teacher/stats/route.ts"],"sourcesContent":["import { getSupabaseAdmin } from '@/lib/supabaseAdmin'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const admin = getSupabaseAdmin()\n    const { searchParams } = new URL(request.url)\n    const teacherId = searchParams.get('teacherId')\n\n    if (!teacherId) {\n      return NextResponse.json({\n        success: true,\n        data: {\n          totalStudents: 0,\n          classesToday: 0,\n          pendingGrades: 0,\n          journalEntries: 0,\n          todaySchedule: [],\n          announcements: [],\n        },\n      })\n    }\n\n    // Get teacher's classes\n    const { data: classes, error: classesError } = await admin\n      .from('classes')\n      .select('id, class_name, section, room, schedule')\n      .eq('teacher_id', teacherId)\n      .eq('is_active', true)\n\n    if (classesError) {\n      console.error('Error fetching classes:', classesError)\n    }\n\n    // Get total students in teacher's classes\n    let totalStudents = 0\n    if (classes && classes.length > 0) {\n      const classIds = classes.map(c => c.id)\n      const { count, error: enrollmentError } = await admin\n        .from('class_enrollments')\n        .select('*', { count: 'exact', head: true })\n        .in('class_id', classIds)\n        .eq('status', 'active')\n\n      if (!enrollmentError && count !== null) {\n        totalStudents = count\n      }\n    }\n\n    // Get today's schedule\n    const today = new Date().toLocaleDateString('en-US', { weekday: 'long' })\n    const todaySchedule: any[] = []\n    \n    if (classes) {\n      classes.forEach(classInfo => {\n        if (classInfo.schedule) {\n          try {\n            const scheduleData = typeof classInfo.schedule === 'string' \n              ? JSON.parse(classInfo.schedule) \n              : classInfo.schedule\n\n            if (Array.isArray(scheduleData)) {\n              scheduleData.forEach(item => {\n                if (item.day === today) {\n                  todaySchedule.push({\n                    subject: classInfo.class_name,\n                    section: classInfo.section,\n                    room: classInfo.room,\n                    timeStart: item.timeStart || item.start_time,\n                    timeEnd: item.timeEnd || item.end_time\n                  })\n                }\n              })\n            } else if (typeof scheduleData === 'object' && scheduleData[today]) {\n              const daySchedule = scheduleData[today]\n              if (Array.isArray(daySchedule)) {\n                daySchedule.forEach((timeSlot: any) => {\n                  todaySchedule.push({\n                    subject: classInfo.class_name,\n                    section: classInfo.section,\n                    room: classInfo.room,\n                    timeStart: timeSlot.timeStart || timeSlot.start,\n                    timeEnd: timeSlot.timeEnd || timeSlot.end\n                  })\n                })\n              }\n            }\n          } catch (parseError) {\n            console.error('Error parsing schedule:', parseError)\n          }\n        }\n      })\n    }\n\n    // Sort today's schedule by time\n    todaySchedule.sort((a, b) => a.timeStart.localeCompare(b.timeStart))\n\n    // Get journal entries count\n    const { count: journalCount } = await admin\n      .from('journal_entries')\n      .select('*', { count: 'exact', head: true })\n      .eq('teacher_id', teacherId)\n\n    // Get active announcements\n    const { data: announcements } = await admin\n      .from('announcements')\n      .select('id, title, content, priority, published_at')\n      .eq('is_active', true)\n      .or('target_audience.eq.all,target_audience.eq.teachers')\n      .lte('published_at', new Date().toISOString())\n      .order('priority', { ascending: false })\n      .order('published_at', { ascending: false })\n      .limit(5)\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        totalStudents: totalStudents,\n        classesToday: todaySchedule.length,\n        pendingGrades: 0, // Can be calculated if you track grade completion\n        journalEntries: journalCount || 0,\n        todaySchedule: todaySchedule,\n        announcements: announcements || [],\n      },\n    })\n  } catch (error: any) {\n    console.error('Teacher stats API error:', error)\n    return NextResponse.json(\n      {\n        success: false,\n        error: error?.message || 'Internal server error',\n        data: {\n          totalStudents: 0,\n          classesToday: 0,\n          pendingGrades: 0,\n          journalEntries: 0,\n          todaySchedule: [],\n          announcements: [],\n        },\n      },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}