{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Supabase Admin Client for Server-Side Operations\n * \n * ⚠️ SECURITY WARNING: This client uses the SERVICE ROLE KEY\n * - Bypasses ALL Row Level Security (RLS) policies\n * - Full database access with no restrictions\n * - ONLY use in server-side code (API routes, Server Components)\n * - NEVER import or use in client-side components\n * \n * Use Cases:\n * - Admin operations requiring elevated privileges\n * - System-level database operations\n * - Background jobs and cron tasks\n */\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n/**\n * Creates and returns a Supabase admin client instance\n * \n * @returns SupabaseClient with full admin privileges\n * @throws Error if environment variables are not set\n * \n * @example\n * ```ts\n * // In API route or Server Component only\n * const supabaseAdmin = getSupabaseAdmin();\n * const { data } = await supabaseAdmin.from('users').select('*');\n * ```\n */\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA;;;;;;;;;;;;;CAaC,GAED,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAerD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mRAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/teacher/schedule/route.ts"],"sourcesContent":["import { getSupabaseAdmin } from '@/lib/supabaseAdmin'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const admin = getSupabaseAdmin()\n    const { searchParams } = new URL(request.url)\n    const teacherId = searchParams.get('teacherId')\n    const date = searchParams.get('date')\n\n    if (!teacherId) {\n      return NextResponse.json(\n        { success: false, error: 'Teacher ID is required' },\n        { status: 400 }\n      )\n    }\n\n    // Get teacher's classes with schedule info\n    const { data: classes, error: classesError } = await admin\n      .from('classes')\n      .select('*')\n      .eq('teacher_id', teacherId)\n      .eq('is_active', true)\n\n    if (classesError) {\n      console.error('Error fetching schedule:', classesError)\n      return NextResponse.json(\n        { success: false, error: 'Failed to fetch schedule' },\n        { status: 500 }\n      )\n    }\n\n    if (!classes || classes.length === 0) {\n      return NextResponse.json({\n        success: true,\n        data: [],\n        message: 'No schedule found for this teacher'\n      })\n    }\n\n    // Parse schedule from JSON field if it exists\n    // Schedule format: { \"Monday\": [{ \"timeStart\": \"08:00\", \"timeEnd\": \"09:00\" }], ... }\n    const scheduleItems: any[] = []\n    \n    classes.forEach(classInfo => {\n      if (classInfo.schedule) {\n        try {\n          const scheduleData = typeof classInfo.schedule === 'string' \n            ? JSON.parse(classInfo.schedule) \n            : classInfo.schedule\n\n          // Handle different schedule formats\n          if (Array.isArray(scheduleData)) {\n            // If schedule is an array of items\n            scheduleData.forEach(item => {\n              scheduleItems.push({\n                id: `${classInfo.id}-${item.day || ''}-${item.timeStart || ''}`,\n                classId: classInfo.id,\n                className: classInfo.class_name,\n                subject: classInfo.class_name,\n                section: classInfo.section || 'N/A',\n                gradeLevel: classInfo.grade_level || 'N/A',\n                room: classInfo.room || 'TBA',\n                day: item.day,\n                timeStart: item.timeStart || item.start_time,\n                timeEnd: item.timeEnd || item.end_time,\n                schoolYear: classInfo.school_year,\n                semester: classInfo.semester\n              })\n            })\n          } else if (typeof scheduleData === 'object') {\n            // If schedule is an object with days as keys\n            Object.entries(scheduleData).forEach(([day, times]: [string, any]) => {\n              if (Array.isArray(times)) {\n                times.forEach((timeSlot: any) => {\n                  scheduleItems.push({\n                    id: `${classInfo.id}-${day}-${timeSlot.timeStart || timeSlot.start}`,\n                    classId: classInfo.id,\n                    className: classInfo.class_name,\n                    subject: classInfo.class_name,\n                    section: classInfo.section || 'N/A',\n                    gradeLevel: classInfo.grade_level || 'N/A',\n                    room: classInfo.room || 'TBA',\n                    day: day,\n                    timeStart: timeSlot.timeStart || timeSlot.start,\n                    timeEnd: timeSlot.timeEnd || timeSlot.end,\n                    schoolYear: classInfo.school_year,\n                    semester: classInfo.semester\n                  })\n                })\n              }\n            })\n          }\n        } catch (parseError) {\n          console.error('Error parsing schedule for class:', classInfo.id, parseError)\n        }\n      } else {\n        // If no schedule field, return basic class info\n        scheduleItems.push({\n          id: classInfo.id,\n          classId: classInfo.id,\n          className: classInfo.class_name,\n          subject: classInfo.class_name,\n          section: classInfo.section || 'N/A',\n          gradeLevel: classInfo.grade_level || 'N/A',\n          room: classInfo.room || 'TBA',\n          day: 'TBA',\n          timeStart: 'TBA',\n          timeEnd: 'TBA',\n          schoolYear: classInfo.school_year,\n          semester: classInfo.semester\n        })\n      }\n    })\n\n    // Filter by date if provided\n    let filteredSchedule = scheduleItems\n    if (date) {\n      const dayName = new Date(date).toLocaleDateString('en-US', { weekday: 'long' })\n      filteredSchedule = scheduleItems.filter(item => item.day === dayName)\n    }\n\n    // Sort by time\n    filteredSchedule.sort((a, b) => {\n      if (a.timeStart === 'TBA') return 1\n      if (b.timeStart === 'TBA') return -1\n      return a.timeStart.localeCompare(b.timeStart)\n    })\n\n    return NextResponse.json({\n      success: true,\n      data: filteredSchedule\n    })\n  } catch (error: any) {\n    console.error('Teacher schedule API error:', error)\n    return NextResponse.json(\n      {\n        success: false,\n        error: error?.message || 'Internal server error'\n      },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}