{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Supabase Admin Client for Server-Side Operations\n * \n * ⚠️ SECURITY WARNING: This client uses the SERVICE ROLE KEY\n * - Bypasses ALL Row Level Security (RLS) policies\n * - Full database access with no restrictions\n * - ONLY use in server-side code (API routes, Server Components)\n * - NEVER import or use in client-side components\n * \n * Use Cases:\n * - Admin operations requiring elevated privileges\n * - System-level database operations\n * - Background jobs and cron tasks\n */\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n/**\n * Creates and returns a Supabase admin client instance\n * \n * @returns SupabaseClient with full admin privileges\n * @throws Error if environment variables are not set\n * \n * @example\n * ```ts\n * // In API route or Server Component only\n * const supabaseAdmin = getSupabaseAdmin();\n * const { data } = await supabaseAdmin.from('users').select('*');\n * ```\n */\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA;;;;;;;;;;;;;CAaC,GAED,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAerD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mRAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/admin/teachers/%5Bid%5D/route.ts"],"sourcesContent":["import { getSupabaseAdmin } from '@/lib/supabaseAdmin';\nimport { NextResponse } from 'next/server';\n\nexport async function GET(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const supabaseAdmin = getSupabaseAdmin()\n    const { data, error } = await supabaseAdmin\n      .from('users')\n      .select('*')\n      .eq('id', id)\n      .eq('role', 'teacher')\n      .single()\n\n    if (error) {\n      return NextResponse.json(\n        { success: false, error: 'Teacher not found' },\n        { status: 404 }\n      )\n    }\n\n    return NextResponse.json({ success: true, teacher: data })\n  } catch (error: any) {\n    return NextResponse.json(\n      { success: false, error: error?.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function PUT(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const body = await request.json()\n    const {\n      first_name,\n      last_name,\n      middle_name,\n      employee_number,\n      department,\n      specialization,\n      email,\n      phone_number,\n      date_of_birth,\n      date_hired,\n      address,\n      rfid,\n    } = body\n\n    const supabaseAdmin = getSupabaseAdmin()\n\n    // Build update object with only defined values\n    const updateData: any = {}\n    if (first_name !== undefined) updateData.first_name = first_name\n    if (last_name !== undefined) updateData.last_name = last_name\n    if (middle_name !== undefined) updateData.middle_name = middle_name || null\n    if (employee_number !== undefined) updateData.employee_number = employee_number\n    if (department !== undefined) updateData.department = department || null\n    if (specialization !== undefined) updateData.specialization = specialization || null\n    if (email !== undefined) updateData.email = email\n    if (phone_number !== undefined) updateData.phone_number = phone_number || null\n    if (date_of_birth !== undefined) updateData.date_of_birth = date_of_birth || null\n    if (date_hired !== undefined) updateData.date_hired = date_hired || null\n    if (address !== undefined) updateData.address = address || null\n    if (rfid !== undefined) updateData.rfid = rfid || null\n\n    // Update user record\n    const { error: updateError } = await supabaseAdmin\n      .from('users')\n      .update(updateData)\n      .eq('id', id)\n      .eq('role', 'teacher')\n\n    if (updateError) {\n      return NextResponse.json(\n        { success: false, error: updateError.message },\n        { status: 400 }\n      )\n    }\n\n    // Update auth email if changed\n    try {\n      await supabaseAdmin.auth.admin.updateUserById(id, { email })\n    } catch (authError) {\n      console.error('Failed to update auth email:', authError)\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Teacher updated successfully',\n    })\n  } catch (error: any) {\n    return NextResponse.json(\n      { success: false, error: error?.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params\n    const supabaseAdmin = getSupabaseAdmin()\n\n    // Delete from users table first\n    const { error: deleteError } = await supabaseAdmin\n      .from('users')\n      .delete()\n      .eq('id', id)\n      .eq('role', 'teacher')\n\n    if (deleteError) {\n      return NextResponse.json(\n        { success: false, error: deleteError.message },\n        { status: 400 }\n      )\n    }\n\n    // Delete auth user\n    try {\n      await supabaseAdmin.auth.admin.deleteUser(id)\n    } catch (authError) {\n      console.error('Failed to delete auth user:', authError)\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Teacher deleted successfully',\n    })\n  } catch (error: any) {\n    return NextResponse.json(\n      { success: false, error: error?.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}