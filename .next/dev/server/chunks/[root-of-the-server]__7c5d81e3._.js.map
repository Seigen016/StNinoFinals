{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Supabase Admin Client for Server-Side Operations\n * \n * ⚠️ SECURITY WARNING: This client uses the SERVICE ROLE KEY\n * - Bypasses ALL Row Level Security (RLS) policies\n * - Full database access with no restrictions\n * - ONLY use in server-side code (API routes, Server Components)\n * - NEVER import or use in client-side components\n * \n * Use Cases:\n * - Admin operations requiring elevated privileges\n * - System-level database operations\n * - Background jobs and cron tasks\n */\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n/**\n * Creates and returns a Supabase admin client instance\n * \n * @returns SupabaseClient with full admin privileges\n * @throws Error if environment variables are not set\n * \n * @example\n * ```ts\n * // In API route or Server Component only\n * const supabaseAdmin = getSupabaseAdmin();\n * const { data } = await supabaseAdmin.from('users').select('*');\n * ```\n */\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA;;;;;;;;;;;;;CAaC,GAED,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAerD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,yMAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/parent/children/route.ts"],"sourcesContent":["import { getSupabaseAdmin } from '@/lib/supabaseAdmin'\nimport { NextResponse } from 'next/server'\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const parent_id = searchParams.get('parent_id')\n\n    if (!parent_id) {\n      return NextResponse.json(\n        { success: false, error: 'Parent ID is required' },\n        { status: 400 }\n      )\n    }\n\n    const supabaseAdmin = getSupabaseAdmin()\n\n    // Fetch children through user_relationships table\n    const { data: relationships, error } = await supabaseAdmin\n      .from('user_relationships')\n      .select(`\n        related_user_id,\n        users!user_relationships_related_user_id_fkey(\n          id,\n          first_name,\n          last_name,\n          student_number,\n          grade_level,\n          section,\n          email\n        )\n      `)\n      .eq('user_id', parent_id)\n\n    if (error) {\n      console.error('Error fetching children:', error)\n      return NextResponse.json(\n        { success: false, error: error.message },\n        { status: 400 }\n      )\n    }\n\n    // Transform the data to get clean children array\n    const children = relationships\n      ?.map((rel: any) => {\n        const user = rel.users\n        if (!user) return null\n        \n        return {\n          id: user.id,\n          name: `${user.first_name || ''} ${user.last_name || ''}`.trim(),\n          student_id: user.student_number,\n          grade_level: user.grade_level,\n          section: user.section,\n          email: user.email,\n          first_name: user.first_name,\n          last_name: user.last_name,\n        }\n      })\n      .filter(Boolean) || []\n\n    return NextResponse.json({\n      success: true,\n      children,\n    })\n  } catch (error: any) {\n    console.error('Fetch children error:', error)\n    return NextResponse.json(\n      { success: false, error: error?.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;QAEnC,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,gBAAgB,IAAA,0IAAgB;QAEtC,kDAAkD;QAClD,MAAM,EAAE,MAAM,aAAa,EAAE,KAAK,EAAE,GAAG,MAAM,cAC1C,IAAI,CAAC,sBACL,MAAM,CAAC,CAAC;;;;;;;;;;;MAWT,CAAC,EACA,EAAE,CAAC,WAAW;QAEjB,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iDAAiD;QACjD,MAAM,WAAW,eACb,IAAI,CAAC;YACL,MAAM,OAAO,IAAI,KAAK;YACtB,IAAI,CAAC,MAAM,OAAO;YAElB,OAAO;gBACL,IAAI,KAAK,EAAE;gBACX,MAAM,GAAG,KAAK,UAAU,IAAI,GAAG,CAAC,EAAE,KAAK,SAAS,IAAI,IAAI,CAAC,IAAI;gBAC7D,YAAY,KAAK,cAAc;gBAC/B,aAAa,KAAK,WAAW;gBAC7B,SAAS,KAAK,OAAO;gBACrB,OAAO,KAAK,KAAK;gBACjB,YAAY,KAAK,UAAU;gBAC3B,WAAW,KAAK,SAAS;YAC3B;QACF,GACC,OAAO,YAAY,EAAE;QAExB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,OAAO,WAAW;QAAwB,GACnE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}