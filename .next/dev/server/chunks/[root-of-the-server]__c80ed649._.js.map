{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/admin/settings/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { getSupabaseAdmin } from '@/lib/supabaseAdmin'\n\n// Use admin client for server-side operations (uses SERVICE_ROLE_KEY, not anon key)\n// This is critical: server-side API routes MUST use service role key, not anon key\n\n// Default settings\nconst DEFAULT_SETTINGS = {\n  schoolName: \"Sto Ni√±o de Praga Academy\",\n  academicYear: \"2024-2025\",\n  automaticBackup: true,\n  rfidIntegration: true,\n  emailNotifications: true,\n  studentPortal: true,\n  teacherPortal: true,\n}\n\n// GET - Fetch settings\nexport async function GET() {\n  try {\n    // Try to fetch from database (if you have a settings table)\n    // For now, return default settings\n    // You can later implement database storage:\n    /*\n    const supabase = getSupabaseAdmin() // Use admin client with service role key\n    const { data, error } = await supabase\n      .from(\"settings\")\n      .select(\"*\")\n      .eq(\"id\", 1)\n      .single()\n    \n    if (error || !data) {\n      return NextResponse.json({\n        success: true,\n        settings: DEFAULT_SETTINGS,\n      })\n    }\n    \n    return NextResponse.json({\n      success: true,\n      settings: {\n        ...DEFAULT_SETTINGS,\n        ...data,\n      },\n    })\n    */\n\n    return NextResponse.json({\n      success: true,\n      settings: DEFAULT_SETTINGS,\n    })\n  } catch (error: any) {\n    console.error(\"Error fetching settings:\", error)\n    return NextResponse.json(\n      {\n        success: false,\n        error: \"Failed to fetch settings\",\n        settings: DEFAULT_SETTINGS,\n      },\n      { status: 200 } // Return 200 instead of 500 to prevent frontend crashes\n    )\n  }\n}\n\n// POST - Save settings\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    \n    // Validate settings structure\n    const settings = {\n      schoolName: body.schoolName || DEFAULT_SETTINGS.schoolName,\n      academicYear: body.academicYear || DEFAULT_SETTINGS.academicYear,\n      automaticBackup: body.automaticBackup ?? DEFAULT_SETTINGS.automaticBackup,\n      rfidIntegration: body.rfidIntegration ?? DEFAULT_SETTINGS.rfidIntegration,\n      emailNotifications: body.emailNotifications ?? DEFAULT_SETTINGS.emailNotifications,\n      studentPortal: body.studentPortal ?? DEFAULT_SETTINGS.studentPortal,\n      teacherPortal: body.teacherPortal ?? DEFAULT_SETTINGS.teacherPortal,\n    }\n\n    // Save to database (if you have a settings table)\n    // For now, just return the settings\n    // You can later implement database storage:\n    /*\n    const supabase = getSupabaseAdmin() // Use admin client with service role key\n    const { data, error } = await supabase\n      .from(\"settings\")\n      .upsert(\n        {\n          id: 1,\n          ...settings,\n          updated_at: new Date().toISOString(),\n        },\n        { onConflict: \"id\" }\n      )\n      .select()\n      .single()\n    \n    if (error) {\n      throw error\n    }\n    */\n\n    return NextResponse.json({\n      success: true,\n      settings: settings,\n      message: \"Settings saved successfully\",\n    })\n  } catch (error: any) {\n    console.error(\"Error saving settings:\", error)\n    return NextResponse.json(\n      {\n        success: false,\n        error: error?.message || \"Failed to save settings\",\n      },\n      { status: 200 } // Return 200 instead of 500 to prevent frontend crashes\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,oFAAoF;AACpF,mFAAmF;AAEnF,mBAAmB;AACnB,MAAM,mBAAmB;IACvB,YAAY;IACZ,cAAc;IACd,iBAAiB;IACjB,iBAAiB;IACjB,oBAAoB;IACpB,eAAe;IACf,eAAe;AACjB;AAGO,eAAe;IACpB,IAAI;QACF,4DAA4D;QAC5D,mCAAmC;QACnC,4CAA4C;QAC5C;;;;;;;;;;;;;;;;;;;;;;IAsBA,GAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU;QACZ;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;YACP,UAAU;QACZ,GACA;YAAE,QAAQ;QAAI,EAAE,wDAAwD;;IAE5E;AACF;AAGO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,8BAA8B;QAC9B,MAAM,WAAW;YACf,YAAY,KAAK,UAAU,IAAI,iBAAiB,UAAU;YAC1D,cAAc,KAAK,YAAY,IAAI,iBAAiB,YAAY;YAChE,iBAAiB,KAAK,eAAe,IAAI,iBAAiB,eAAe;YACzE,iBAAiB,KAAK,eAAe,IAAI,iBAAiB,eAAe;YACzE,oBAAoB,KAAK,kBAAkB,IAAI,iBAAiB,kBAAkB;YAClF,eAAe,KAAK,aAAa,IAAI,iBAAiB,aAAa;YACnE,eAAe,KAAK,aAAa,IAAI,iBAAiB,aAAa;QACrE;QAEA,kDAAkD;QAClD,oCAAoC;QACpC,4CAA4C;QAC5C;;;;;;;;;;;;;;;;;;IAkBA,GAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU;YACV,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,OAAO,WAAW;QAC3B,GACA;YAAE,QAAQ;QAAI,EAAE,wDAAwD;;IAE5E;AACF"}}]
}