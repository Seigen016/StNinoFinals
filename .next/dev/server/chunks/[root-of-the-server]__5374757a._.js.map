{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/lib/supabaseAdmin.ts"],"sourcesContent":["import { Database } from '@/database.types'\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\n/**\n * Supabase Admin Client for Server-Side Operations\n * \n * ⚠️ SECURITY WARNING: This client uses the SERVICE ROLE KEY\n * - Bypasses ALL Row Level Security (RLS) policies\n * - Full database access with no restrictions\n * - ONLY use in server-side code (API routes, Server Components)\n * - NEVER import or use in client-side components\n * \n * Use Cases:\n * - Admin operations requiring elevated privileges\n * - System-level database operations\n * - Background jobs and cron tasks\n */\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\n/**\n * Creates and returns a Supabase admin client instance\n * \n * @returns SupabaseClient with full admin privileges\n * @throws Error if environment variables are not set\n * \n * @example\n * ```ts\n * // In API route or Server Component only\n * const supabaseAdmin = getSupabaseAdmin();\n * const { data } = await supabaseAdmin.from('users').select('*');\n * ```\n */\nexport function getSupabaseAdmin(): SupabaseClient {\n  if (!supabaseUrl || !serviceRoleKey) {\n    throw new Error('Missing Supabase admin env. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY (server-only).')\n  }\n  \n  return createClient<Database>(supabaseUrl as string, serviceRoleKey as string, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEA;;;;;;;;;;;;;CAaC,GAED,MAAM;AACN,MAAM,iBAAiB,QAAQ,GAAG,CAAC,yBAAyB;AAerD,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,gBAAgB;QACnC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAA,mRAAY,EAAW,aAAuB,gBAA0B;QAC7E,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/koyaemer/Development/StNinoFinals/app/api/admin/teachers/route.ts"],"sourcesContent":["import { getSupabaseAdmin } from '@/lib/supabaseAdmin'\nimport { NextResponse } from 'next/server'\n\n// GET - Fetch all teachers\nexport async function GET() {\n  try {\n    const admin = getSupabaseAdmin()\n\n    const { data: teachers, error } = await admin\n      .from('users')\n      .select('*')\n      .eq('role', 'teacher')\n      .order('created_at', { ascending: false })\n\n    if (error) {\n      console.error('Error fetching teachers:', error)\n      return NextResponse.json(\n        { success: false, error: error.message },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      teachers: teachers || [],\n    })\n  } catch (error: any) {\n    console.error('Server error:', error)\n    return NextResponse.json(\n      { success: false, error: error.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\n// POST - Create a new teacher\nexport async function POST(request: Request) {\n  try {\n    const admin = getSupabaseAdmin()\n    const body = await request.json()\n\n    const {\n      first_name,\n      last_name,\n      middle_name,\n      employee_number,\n      email,\n      phone_number,\n      department,\n      specialization,\n      date_hired,\n      date_of_birth,\n      address,\n      rfid,\n      password,\n    } = body\n\n    // Validation\n    if (!first_name || !last_name || !email) {\n      return NextResponse.json(\n        { success: false, error: 'First name, last name, and email are required' },\n        { status: 400 }\n      )\n    }\n\n    // Check if email already exists\n    const { data: existingUser } = await admin\n      .from('users')\n      .select('id')\n      .eq('email', email)\n      .single()\n\n    if (existingUser) {\n      return NextResponse.json(\n        { success: false, error: 'A user with this email already exists' },\n        { status: 400 }\n      )\n    }\n\n    // Create auth user\n    const { data: authData, error: authError } = await admin.auth.admin.createUser({\n      email,\n      password: password || Math.random().toString(36).slice(-8),\n      email_confirm: true,\n    })\n\n    if (authError) {\n      console.error('Auth error:', authError)\n      return NextResponse.json(\n        { success: false, error: `Authentication error: ${authError.message}` },\n        { status: 500 }\n      )\n    }\n\n    // Insert teacher into users table\n    const { data: teacher, error: insertError } = await admin\n      .from('users')\n      .insert([\n        {\n          id: authData.user.id,\n          email,\n          first_name,\n          last_name,\n          middle_name: middle_name || null,\n          employee_number: employee_number || null,\n          phone_number: phone_number || null,\n          department: department || null,\n          specialization: specialization || null,\n          date_hired: date_hired || null,\n          date_of_birth: date_of_birth || null,\n          address: address || null,\n          rfid: rfid || null,\n          role: 'teacher',\n          status: 'Active',\n        },\n      ])\n      .select()\n      .single()\n\n    if (insertError) {\n      console.error('Insert error:', insertError)\n      // Try to delete the auth user if insert fails\n      await admin.auth.admin.deleteUser(authData.user.id)\n      return NextResponse.json(\n        { success: false, error: `Failed to create teacher: ${insertError.message}` },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({\n      success: true,\n      teacher,\n      message: 'Teacher created successfully',\n    })\n  } catch (error: any) {\n    console.error('Server error:', error)\n    return NextResponse.json(\n      { success: false, error: error.message || 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}