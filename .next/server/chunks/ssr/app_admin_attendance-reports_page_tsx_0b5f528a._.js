module.exports=[72513,a=>{"use strict";var b=a.i(95526),c=a.i(21113),d=a.i(4640),e=a.i(40695),f=a.i(3130),g=a.i(5522),h=a.i(17171),i=a.i(88237),j=a.i(54161),k=a.i(87682),l=a.i(62159),m=a.i(88533),n=a.i(46916);function o(){let[a,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)("all"),[B,C]=(0,c.useState)("all");(0,c.useEffect)(()=>{let a=new Date,b=new Date;b.setDate(b.getDate()-30),w(b.toISOString().split("T")[0]),y(a.toISOString().split("T")[0])},[]);let D=async()=>{q(!0),s(null);try{let a=new URLSearchParams;v&&a.append("startDate",v),x&&a.append("endDate",x),t&&a.append("studentId",t),z&&"all"!==z&&a.append("gradeLevel",z),B&&"all"!==B&&a.append("section",B),console.log("ðŸ” Fetching attendance reports with params:",a.toString());let b=await fetch(`/api/admin/attendance-reports?${a.toString()}`);if(!b.ok)throw Error(`HTTP error! status: ${b.status}`);let c=await b.json();console.log("ðŸ“Š API Response:",c),c.success&&c.data?(o(c.data),s(null),!t&&c.data.students.length>0&&u(c.data.students[0].studentId)):(s(c.error||"Failed to fetch attendance data"),o(null))}catch(a){console.error("âŒ Error fetching attendance reports:",a),s(a?.message||"An error occurred while fetching attendance data"),o(null)}finally{q(!1)}};(0,c.useEffect)(()=>{v&&x&&D()},[v,x,t,z,B]);let E=(0,c.useMemo)(()=>a&&t?a.students.find(a=>a.studentId===t)||a.selectedStudent:null,[a,t]),F=(0,c.useMemo)(()=>{if(!a)return[];let b=[],c=new Date(a.dateRange.start),d=new Date(a.dateRange.end);for(let a=new Date(c);a<=d;a.setDate(a.getDate()+1))b.push(new Date(a).toISOString().split("T")[0]);return b},[a]),G=a=>new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"numeric",day:"numeric"}),H=(0,c.useMemo)(()=>{if(!E)return null;let a={PR:0,AC:0,LA:0,EX:0,HO:0,EA:0,DA:0,SU:0,O:0,VA:0,CR:0,D1:0,D2:0,D3:0,D4:0,D5:0,D6:0};return Object.values(E.dailyAttendance).forEach(b=>{a.hasOwnProperty(b)&&a[b]++}),a},[E]);return p?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(m.RefreshCcw,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-red-800"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading attendance reports..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("header",{className:"bg-white shadow-md border-b-4 border-red-800",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(d.default,{href:"/admin",children:(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(l.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-red-800",style:{fontFamily:"serif"},children:"Attendance Tracker"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Student attendance monitoring and analytics"})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Label,{htmlFor:"startDate",className:"text-sm",children:"Start Date:"}),(0,b.jsx)(g.Input,{id:"startDate",type:"date",value:v,onChange:a=>w(a.target.value),className:"w-40"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Label,{htmlFor:"endDate",className:"text-sm",children:"End Date:"}),(0,b.jsx)(g.Input,{id:"endDate",type:"date",value:x,onChange:a=>y(a.target.value),className:"w-40"})]}),(0,b.jsxs)(e.Button,{onClick:D,variant:"outline",size:"sm",children:[(0,b.jsx)(m.RefreshCcw,{className:"w-4 h-4 mr-2"}),"Refresh"]}),a&&a.students.length>0&&(0,b.jsxs)(e.Button,{onClick:()=>{if(!a||!a.students.length)return;let b=[["#","Name","Total Days","Present","Absent","Late","Excused","%",...F.map(a=>G(a))]];a.students.forEach((a,c)=>{let d=[(c+1).toString(),a.studentName,a.totalDays.toString(),a.present.toString(),a.absent.toString(),a.late.toString(),a.excused.toString(),`${a.percentage}%`,...F.map(b=>a.dailyAttendance[b]||"-")];b.push(d)});let c=new Blob([b.map(a=>a.map(a=>`"${a.toString().replace(/"/g,'""')}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),e=URL.createObjectURL(c);d.setAttribute("href",e),d.setAttribute("download",`attendance-report-${v}-to-${x}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},variant:"outline",size:"sm",className:"bg-green-50 hover:bg-green-100",children:[(0,b.jsx)(n.Download,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]})]})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:r?(0,b.jsx)(f.Card,{children:(0,b.jsxs)(f.CardContent,{className:"py-12 text-center",children:[(0,b.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,b.jsx)("p",{className:"text-lg font-semibold",children:"Error Loading Attendance Data"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:r})]}),(0,b.jsxs)(e.Button,{onClick:D,variant:"outline",className:"mt-4",children:[(0,b.jsx)(m.RefreshCcw,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})}):a&&0!==a.students.length?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,b.jsxs)(f.Card,{className:"lg:col-span-2",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-red-800 uppercase",children:"General Attendance"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)("div",{className:"flex items-center justify-center space-x-8",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-red-600",children:[a.general.absentPercentage.toFixed(1),"%"]}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Absent"})]}),(0,b.jsxs)("div",{className:"relative w-32 h-32",children:[(0,b.jsxs)("svg",{className:"transform -rotate-90 w-32 h-32",children:[(0,b.jsx)("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),(0,b.jsx)("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:`${2*Math.PI*56}`,strokeDashoffset:`${2*Math.PI*56*(1-a.general.presentPercentage/100)}`,className:"text-green-500",strokeLinecap:"round"})]}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:[a.general.presentPercentage.toFixed(1),"%"]}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Present"})]})})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:[a.general.presentPercentage.toFixed(1),"%"]}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Present"})]})]})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-red-800",children:"Select Student"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"studentSelect",className:"text-sm mb-2 block",children:"Select Name:"}),(0,b.jsxs)(k.Select,{value:t,onValueChange:u,children:[(0,b.jsx)(k.SelectTrigger,{id:"studentSelect",children:(0,b.jsx)(k.SelectValue,{placeholder:"Select a student"})}),(0,b.jsx)(k.SelectContent,{children:a.students.map(a=>(0,b.jsx)(k.SelectItem,{value:a.studentId,children:a.studentName},a.studentId))})]})]}),E&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-gray-800",children:"Total Days"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-red-800",children:E.totalDays})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-gray-800",children:"Present"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:E.present})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-lg font-bold text-gray-800",children:"%"}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-red-800 bg-red-50 px-3 py-1 rounded",children:[E.percentage,"%"]})]})]}),H&&(0,b.jsxs)("div",{className:"pt-4 border-t",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Attendance Breakdown:"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:Object.entries(H).filter(([a,b])=>b>0).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"font-medium",children:[a,":"]}),(0,b.jsx)("span",{className:"text-gray-600",children:c})]},a))})]})]})]})]})]}),(0,b.jsxs)(f.Card,{className:"mb-6",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-red-800 text-sm",children:"Filters"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"gradeFilter",className:"text-sm mb-2 block",children:"Grade Level:"}),(0,b.jsxs)(k.Select,{value:z,onValueChange:A,children:[(0,b.jsx)(k.SelectTrigger,{id:"gradeFilter",children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"all",children:"All Grades"}),a.filters.gradeLevels.map(a=>(0,b.jsx)(k.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"sectionFilter",className:"text-sm mb-2 block",children:"Section:"}),(0,b.jsxs)(k.Select,{value:B,onValueChange:C,children:[(0,b.jsx)(k.SelectTrigger,{id:"sectionFilter",children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"all",children:"All Sections"}),a.filters.sections.map(a=>(0,b.jsx)(k.SelectItem,{value:a,children:a},a))]})]})]})]})})]}),(0,b.jsxs)(f.Card,{className:"mb-6",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{className:"text-red-800",children:"Attendance Percentage by Student"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:a.students.slice(0,10).map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-32 text-sm text-gray-700 truncate",children:a.studentName}),(0,b.jsxs)("div",{className:"flex-1 h-8 bg-gray-200 rounded-full overflow-hidden relative",children:[(0,b.jsx)("div",{className:`h-full ${a.percentage>=90?"bg-green-500":a.percentage>=70?"bg-yellow-500":"bg-red-500"} transition-all duration-500`,style:{width:`${a.percentage}%`}}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsxs)("span",{className:"text-xs font-semibold text-gray-900",children:[a.percentage,"%"]})})]})]},a.studentId))})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{className:"text-red-800",children:"Daily Attendance Records"}),(0,b.jsxs)(f.CardDescription,{children:["Showing attendance for ",a.students.length," student",1!==a.students.length?"s":""]})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-12",children:"#"}),(0,b.jsx)(i.TableHead,{children:"Name"}),(0,b.jsx)(i.TableHead,{className:"text-center",children:"Total Days"}),(0,b.jsx)(i.TableHead,{className:"text-center",children:"Present"}),(0,b.jsx)(i.TableHead,{className:"text-center",children:"%"}),F.slice(0,30).map(a=>(0,b.jsx)(i.TableHead,{className:"text-center min-w-[80px]",children:G(a)},a))]})}),(0,b.jsx)(i.TableBody,{children:a.students.map((a,c)=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:c+1}),(0,b.jsx)(i.TableCell,{className:"font-semibold",children:a.studentName}),(0,b.jsx)(i.TableCell,{className:"text-center",children:a.totalDays}),(0,b.jsx)(i.TableCell,{className:"text-center",children:a.present}),(0,b.jsx)(i.TableCell,{className:"text-center",children:(0,b.jsxs)(j.Badge,{className:a.percentage>=90?"bg-green-500":a.percentage>=70?"bg-yellow-500":"bg-red-500",children:[a.percentage,"%"]})}),F.slice(0,30).map(c=>{let d=a.dailyAttendance[c]||"-";return(0,b.jsx)(i.TableCell,{className:"text-center",children:"-"!==d?(0,b.jsx)(j.Badge,{className:`${(a=>{switch(a){case"PR":return"bg-green-500 text-white";case"AC":return"bg-red-500 text-white";case"LA":return"bg-yellow-500 text-white";case"EX":return"bg-blue-500 text-white";case"HO":return"bg-gray-400 text-white";case"EA":return"bg-orange-500 text-white";case"DA":return"bg-purple-500 text-white";case"SU":return"bg-red-700 text-white";case"O":return"bg-gray-500 text-white";case"VA":return"bg-blue-400 text-white";case"CR":return"bg-purple-400 text-white";case"D1":case"D2":case"D3":case"D4":case"D5":case"D6":return"bg-indigo-500 text-white";default:return"bg-gray-300 text-gray-700"}})(d)} text-xs px-1 py-0`,title:{PR:"Present",AC:"Absent - Coded",LA:"Late",EX:"Excused",HO:"Holiday",EA:"Early Absent",DA:"Day Absent",SU:"Suspended",O:"Other",VA:"Vacation",CR:"Credit",D1:"Day 1",D2:"Day 2",D3:"Day 3",D4:"Day 4",D5:"Day 5",D6:"Day 6"}[d]||d,children:d}):(0,b.jsx)("span",{className:"text-gray-400",children:"-"})},c)})]},a.studentId))})]})})})]})]}):(0,b.jsx)(f.Card,{children:(0,b.jsxs)(f.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)("p",{className:"text-gray-600",children:"No attendance data available."}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Students will appear here once they start scanning their RFID cards."}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mt-4",children:["Date Range: ",v," to ",x]})]})})})]})}a.s(["default",()=>o])}];

//# sourceMappingURL=app_admin_attendance-reports_page_tsx_0b5f528a._.js.map